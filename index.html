---
layout: month
title: "Điểm tin nhanh Ngành Nông Nghiệp"
---

<div class="mb-4 flex flex-wrap items-center gap-3">
  <label class="font-semibold text-green-900">Chọn kỳ:</label>
  <select id="periodSelect" class="rounded-lg border border-green-300 px-3 py-1.5 text-sm"></select>
  <span id="lastUpdated" class="text-xs md:text-sm text-green-700">Cập nhật: —</span>
</div>

<nav class="mb-6 overflow-x-auto"><ul id="tabs" class="flex gap-2 min-w-max"></ul></nav>
<div id="panels" class="space-y-8 md:space-y-12"></div>

<script>
  const months = {{ site.months | sort: "period" | map: "to_liquid" | jsonify }};
  const weeks  = {{ site.weeks  | sort: "week"   | map: "to_liquid" | jsonify }};
</script>
<script>
(async function(){
  const periodSelect=document.getElementById('periodSelect'), tabs=document.getElementById('tabs'), panels=document.getElementById('panels'), last=document.getElementById('lastUpdated');
  const weeksByPeriod = weeks.reduce((m,w)=>{(m[w.period]=m[w.period]||[]).push(w);return m;},{});
  const periods = [...new Set([...months.map(m=>m.period), ...Object.keys(weeksByPeriod)])].sort();

  periods.forEach(p=>{const opt=document.createElement('option');opt.value=p;opt.textContent=p.replace('-','/');periodSelect.appendChild(opt);});
  const saved=localStorage.getItem('agris-period')||periods[0];periodSelect.value=saved;

  async function render(pkey){
    localStorage.setItem('agris-period',pkey);
    tabs.innerHTML='';panels.innerHTML='';
    const m=months.find(x=>x.period===pkey);const w=(weeksByPeriod[pkey]||[]);
    last.textContent='Cập nhật: '+(m?.updated||(w[w.length-1]?.updated||'—'));
    if(m){addTab(`th-${pkey}`,`Tổng hợp ${pkey.split('-')[1]}/${pkey.split('-')[0]}`,m.url);}
    w.forEach(item=>{addTab(`w${item.week}-${pkey}`,`Tuần ${item.week}`,item.url);});
    const first=tabs.querySelector('button');if(first)first.click();
  }
  function addTab(id,label,url){
    const b=document.createElement('button');b.className='pill rounded-full px-3 py-1.5 text-sm font-semibold';b.textContent=label;
    const panel=document.createElement('section');panel.id=id;panel.className='hidden';
    b.onclick=async()=>{
      Array.from(tabs.children).forEach(x=>x.classList.remove('active'));b.classList.add('active');
      Array.from(panels.children).forEach(p=>p.classList.add('hidden'));panel.classList.remove('hidden');
      if(!panel.dataset.loaded){const html=await fetch(url).then(r=>r.text());const tmp=document.createElement('div');tmp.innerHTML=html;const article=tmp.querySelector('article')||tmp.querySelector('main')||tmp;panel.innerHTML=article.innerHTML;panel.dataset.loaded='1';}
    };
    tabs.appendChild(b);panels.appendChild(panel);
  }
  await render(saved);
  periodSelect.onchange=()=>render(periodSelect.value);
})();
</script>
